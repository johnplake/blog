---
title: "John's Synth Lab"
format:
  html:
    page-layout: full
    toc: false
---

```{=html}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    .synth-container {
      font-family: 'Courier New', monospace;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      color: #eee;
      min-height: 100vh;
      padding: 20px;
    }
    .synth-container h1 { text-align: center; margin-bottom: 20px; color: #00d4ff; }
    .container { max-width: 800px; margin: 0 auto; }
    
    .panel {
      background: rgba(255,255,255,0.05);
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
      border: 1px solid rgba(0,212,255,0.3);
    }
    .panel h2 { margin-bottom: 15px; font-size: 14px; color: #00d4ff; }
    
    .wave-buttons { display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; }
    .wave-btn {
      padding: 10px 20px;
      background: rgba(0,212,255,0.1);
      border: 1px solid #00d4ff;
      color: #00d4ff;
      cursor: pointer;
      border-radius: 5px;
      transition: all 0.2s;
    }
    .wave-btn:hover, .wave-btn.active {
      background: #00d4ff;
      color: #1a1a2e;
    }
    
    .slider-group { margin-bottom: 15px; }
    .slider-group label { display: block; margin-bottom: 5px; font-size: 12px; }
    .slider-group input[type="range"] { width: 100%; accent-color: #00d4ff; }
    .slider-value { font-size: 11px; color: #888; }
    
    .sequencer {
      display: grid;
      grid-template-columns: repeat(16, 1fr);
      gap: 4px;
      margin-bottom: 15px;
    }
    .step {
      aspect-ratio: 1;
      background: rgba(255,255,255,0.1);
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.1s;
      border: 1px solid transparent;
      min-width: 20px;
      min-height: 20px;
    }
    .step:hover { background: rgba(0,212,255,0.3); }
    .step.active { background: #00d4ff; }
    .step.playing { border-color: #ff6b6b; box-shadow: 0 0 10px #ff6b6b; }
    
    .note-row { display: flex; align-items: center; gap: 10px; margin-bottom: 4px; }
    .note-label { width: 30px; font-size: 11px; color: #888; }
    .note-row .sequencer { flex: 1; margin-bottom: 0; }
    
    .transport { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
    .transport button {
      padding: 12px 24px;
      font-size: 16px;
      background: #00d4ff;
      border: none;
      color: #1a1a2e;
      cursor: pointer;
      border-radius: 5px;
      font-weight: bold;
    }
    .transport button:hover { background: #00b8e6; }
    .transport button.stop { background: #ff6b6b; }
    .tempo-display { margin-left: auto; font-size: 24px; color: #00d4ff; }
    
    .keyboard { display: flex; justify-content: center; gap: 2px; margin-top: 15px; }
    .key {
      width: 40px;
      height: 120px;
      background: white;
      border: 1px solid #333;
      border-radius: 0 0 5px 5px;
      cursor: pointer;
      transition: background 0.1s;
    }
    .key:hover { background: #ddd; }
    .key:active, .key.pressed { background: #00d4ff; }
    .key.black {
      width: 30px;
      height: 80px;
      background: #333;
      margin: 0 -15px;
      z-index: 1;
      border-radius: 0 0 3px 3px;
    }
    .key.black:hover { background: #555; }
    .key.black:active, .key.black.pressed { background: #00d4ff; }
    
    .status {
      text-align: center;
      padding: 10px;
      font-size: 12px;
      color: #888;
    }
  </style>
</head>
<body>
  <div class="synth-container">
    <div class="container">
      <h1>ðŸŽ¹ John's Synth Lab</h1>
      
      <div class="panel">
        <h2>OSCILLATOR</h2>
        <div class="wave-buttons">
          <button class="wave-btn active" data-wave="sine">Sine</button>
          <button class="wave-btn" data-wave="square">Square</button>
          <button class="wave-btn" data-wave="sawtooth">Saw</button>
          <button class="wave-btn" data-wave="triangle">Triangle</button>
        </div>
        
        <div class="slider-group">
          <label>Attack: <span class="slider-value" id="attackVal">0.1s</span></label>
          <input type="range" id="attack" min="0.01" max="1" step="0.01" value="0.1">
        </div>
        
        <div class="slider-group">
          <label>Release: <span class="slider-value" id="releaseVal">0.3s</span></label>
          <input type="range" id="release" min="0.01" max="2" step="0.01" value="0.3">
        </div>
        
        <div class="slider-group">
          <label>Filter Cutoff: <span class="slider-value" id="filterVal">2000 Hz</span></label>
          <input type="range" id="filter" min="100" max="8000" step="100" value="2000">
        </div>
      </div>
      
      <div class="panel">
        <h2>SEQUENCER (16 steps)</h2>
        <div id="sequencerGrid"></div>
        
        <div class="transport">
          <button id="playBtn">â–¶ Play</button>
          <button id="stopBtn" class="stop">â–  Stop</button>
          <button id="clearBtn">Clear</button>
          <div class="slider-group" style="width: 200px; margin: 0 20px;">
            <label>Tempo: <span id="tempoVal">120</span> BPM</label>
            <input type="range" id="tempo" min="60" max="200" value="120">
          </div>
        </div>
      </div>
      
      <div class="panel">
        <h2>KEYBOARD (click or use keys A-K)</h2>
        <div class="keyboard" id="keyboard"></div>
      </div>
      
      <div class="status" id="status">Click anywhere to enable audio</div>
    </div>
  </div>

  <script>
    let audioCtx = null;
    let masterGain = null;
    let filter = null;
    
    let waveform = 'sine';
    let attack = 0.1;
    let release = 0.3;
    let filterFreq = 2000;
    
    const NOTES = ['C5', 'B4', 'A4', 'G4', 'F4', 'E4', 'D4', 'C4'];
    const NOTE_FREQS = {
      'C4': 261.63, 'D4': 293.66, 'E4': 329.63, 'F4': 349.23,
      'G4': 392.00, 'A4': 440.00, 'B4': 493.88, 'C5': 523.25
    };
    const KEYBOARD_NOTES = ['C4', 'C#4', 'D4', 'D#4', 'E4', 'F4', 'F#4', 'G4', 'G#4', 'A4', 'A#4', 'B4', 'C5'];
    const KEYBOARD_FREQS = {
      'C4': 261.63, 'C#4': 277.18, 'D4': 293.66, 'D#4': 311.13,
      'E4': 329.63, 'F4': 349.23, 'F#4': 369.99, 'G4': 392.00,
      'G#4': 415.30, 'A4': 440.00, 'A#4': 466.16, 'B4': 493.88, 'C5': 523.25
    };
    const KEY_MAP = {'a':'C4','w':'C#4','s':'D4','e':'D#4','d':'E4','f':'F4','t':'F#4','g':'G4','y':'G#4','h':'A4','u':'A#4','j':'B4','k':'C5'};
    
    let sequence = NOTES.map(() => Array(16).fill(false));
    let isPlaying = false;
    let currentStep = 0;
    let intervalId = null;
    let tempo = 120;
    
    function initAudio() {
      if (audioCtx) return;
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      masterGain = audioCtx.createGain();
      masterGain.gain.value = 0.3;
      filter = audioCtx.createBiquadFilter();
      filter.type = 'lowpass';
      filter.frequency.value = filterFreq;
      filter.connect(masterGain);
      masterGain.connect(audioCtx.destination);
      document.getElementById('status').textContent = 'ðŸŽµ Audio enabled!';
    }
    
    function playNote(freq) {
      if (!audioCtx) initAudio();
      const osc = audioCtx.createOscillator();
      const noteGain = audioCtx.createGain();
      osc.type = waveform;
      osc.frequency.value = freq;
      noteGain.gain.setValueAtTime(0, audioCtx.currentTime);
      noteGain.gain.linearRampToValueAtTime(0.5, audioCtx.currentTime + attack);
      noteGain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + attack + release);
      osc.connect(noteGain);
      noteGain.connect(filter);
      osc.start();
      osc.stop(audioCtx.currentTime + attack + release + 0.1);
    }
    
    function buildSequencer() {
      const grid = document.getElementById('sequencerGrid');
      grid.innerHTML = '';
      NOTES.forEach((note, rowIdx) => {
        const row = document.createElement('div');
        row.className = 'note-row';
        const label = document.createElement('div');
        label.className = 'note-label';
        label.textContent = note;
        row.appendChild(label);
        const seq = document.createElement('div');
        seq.className = 'sequencer';
        for (let step = 0; step < 16; step++) {
          const cell = document.createElement('div');
          cell.className = 'step';
          cell.dataset.row = rowIdx;
          cell.dataset.step = step;
          if (sequence[rowIdx][step]) cell.classList.add('active');
          cell.addEventListener('click', () => {
            sequence[rowIdx][step] = !sequence[rowIdx][step];
            cell.classList.toggle('active');
          });
          seq.appendChild(cell);
        }
        row.appendChild(seq);
        grid.appendChild(row);
      });
    }
    
    function buildKeyboard() {
      const kb = document.getElementById('keyboard');
      kb.innerHTML = '';
      KEYBOARD_NOTES.forEach(note => {
        const key = document.createElement('div');
        key.className = 'key' + (note.includes('#') ? ' black' : '');
        key.dataset.note = note;
        key.addEventListener('mousedown', () => {
          playNote(KEYBOARD_FREQS[note]);
          key.classList.add('pressed');
        });
        key.addEventListener('mouseup', () => key.classList.remove('pressed'));
        key.addEventListener('mouseleave', () => key.classList.remove('pressed'));
        kb.appendChild(key);
      });
    }
    
    function tick() {
      document.querySelectorAll('.step.playing').forEach(el => el.classList.remove('playing'));
      document.querySelectorAll('.step[data-step="' + currentStep + '"]').forEach(el => el.classList.add('playing'));
      NOTES.forEach((note, rowIdx) => {
        if (sequence[rowIdx][currentStep]) playNote(NOTE_FREQS[note]);
      });
      currentStep = (currentStep + 1) % 16;
    }
    
    function startSequencer() {
      if (isPlaying) return;
      if (!audioCtx) initAudio();
      isPlaying = true;
      const msPerStep = (60 / tempo) * 1000 / 4;
      intervalId = setInterval(tick, msPerStep);
      document.getElementById('playBtn').textContent = 'â–¶ Playing...';
    }
    
    function stopSequencer() {
      isPlaying = false;
      if (intervalId) clearInterval(intervalId);
      currentStep = 0;
      document.querySelectorAll('.step.playing').forEach(el => el.classList.remove('playing'));
      document.getElementById('playBtn').textContent = 'â–¶ Play';
    }
    
    function clearSequencer() {
      sequence = NOTES.map(() => Array(16).fill(false));
      document.querySelectorAll('.step.active').forEach(el => el.classList.remove('active'));
    }
    
    document.querySelectorAll('.wave-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.wave-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        waveform = btn.dataset.wave;
      });
    });
    
    document.getElementById('attack').addEventListener('input', e => {
      attack = parseFloat(e.target.value);
      document.getElementById('attackVal').textContent = attack.toFixed(2) + 's';
    });
    
    document.getElementById('release').addEventListener('input', e => {
      release = parseFloat(e.target.value);
      document.getElementById('releaseVal').textContent = release.toFixed(2) + 's';
    });
    
    document.getElementById('filter').addEventListener('input', e => {
      filterFreq = parseInt(e.target.value);
      if (filter) filter.frequency.value = filterFreq;
      document.getElementById('filterVal').textContent = filterFreq + ' Hz';
    });
    
    document.getElementById('tempo').addEventListener('input', e => {
      tempo = parseInt(e.target.value);
      document.getElementById('tempoVal').textContent = tempo;
      if (isPlaying) { stopSequencer(); startSequencer(); }
    });
    
    document.getElementById('playBtn').addEventListener('click', startSequencer);
    document.getElementById('stopBtn').addEventListener('click', stopSequencer);
    document.getElementById('clearBtn').addEventListener('click', clearSequencer);
    
    document.addEventListener('keydown', e => {
      if (KEY_MAP[e.key] && !e.repeat) {
        const note = KEY_MAP[e.key];
        playNote(KEYBOARD_FREQS[note]);
        document.querySelector('.key[data-note="' + note + '"]')?.classList.add('pressed');
      }
    });
    
    document.addEventListener('keyup', e => {
      if (KEY_MAP[e.key]) {
        const note = KEY_MAP[e.key];
        document.querySelector('.key[data-note="' + note + '"]')?.classList.remove('pressed');
      }
    });
    
    document.addEventListener('click', initAudio, { once: true });
    buildSequencer();
    buildKeyboard();
  </script>
</body>
</html>
```
